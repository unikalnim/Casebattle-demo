<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Case Battle ‚Äî –ì–ª–∞–≤–Ω–∞—è</title>
  <style>
    :root { --sidebar-width: 182px; }

    body {
      margin: 0;
      color: #fff;
      background: #1b1f27;
      font-family: Arial, sans-serif;
    }

    header {
      position: fixed;
      width: var(--sidebar-width);
      height: 100vh;
      background: #13171f;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
      z-index: 1000;
    }

    header img.logo {
      height: 62px;
      margin-top: 2px;
    }

    .topbar {
      position: relative;
      background: #13171f;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding: 0 25px;
      gap: 50px;
      margin-left: var(--sidebar-width);
    }

    .topbar-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: #ffffff;
      transition: transform 0.2s ease, filter 0.2s ease;
    }

    .topbar-item img { width: 30px; height: 30px; }
    .topbar-item span { font-size: 11px; margin-top: 5px; }

    .topbar-item:hover {
      transform: translateY(-2px);
      filter: drop-shadow(0 2px 3px rgba(0,0,0,0.4));
    }

    .user-info {
      display: none;
      align-items: center;
      gap: 12px;
      background: none;
      color: white;
    }

    .user-info img {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      border: 2px solid #f07a3f;
      object-fit: cover;
    }

    .user-text {
      display: flex;
      flex-direction: column;
      gap: 1px;
      line-height: 1.1;
      font-size: 12px;
      font-weight: 400;
    }

    .hello-text {
      color: #f07a3f;
      font-weight: 500;
      font-size: 12px;
    }

    .nickname {
      color: #ffffff;
      font-size: 13px;
      font-weight: 500;
    }

    .balance-text {
      color: #ffffff;
      font-size: 11px;
      font-weight: 400;
    }

    .balance-amount {
      color: #f07a3f;
      font-weight: 500;
      font-size: 12px;
    }

    .auth-btn, .user-info {
      margin-left: auto;
      border-radius: 8px;
      padding: 10px 18px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
    }

    .auth-btn {
      background-color: #f07a3f;
      color: #fff;
      border: none;
      transition: background 0.3s;
    }
    .auth-btn:hover { background-color: #ff8b55; }

    main {
      margin-left: calc(var(--sidebar-width));
      padding: 30px;
    }

    .admin-panel {
      margin-top: 20px;
      background: #232837;
      padding: 15px;
      border-radius: 8px;
      display: none;
    }

    .admin-panel input {
      background: #1b1f27;
      border: 1px solid #444;
      color: #fff;
      padding: 8px;
      border-radius: 6px;
      margin-right: 10px;
      width: 200px;
    }

    .admin-panel button {
      background: #f07a3f;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      font-weight: bold;
    }
    .admin-panel button:hover {
      background: #ff8b55;
    }
  </style>
</head>
<body>

  <header>
    <a href="index.html"><img src="Screenshot (5).png" alt="logo" class="logo"></a>
  </header>

  <div class="topbar">
    <a href="#" class="topbar-item">
      <img src="upgrade-icon.svg" alt="">
      <span>–ê–ü–ì–†–ï–ô–î</span>
    </a>
    <a href="#" class="topbar-item">
      <img src="contract-icon.svg" alt="">
      <span>–ö–û–ù–¢–†–ê–ö–¢</span>
    </a>
    <a href="#" class="topbar-item">
      <img src="giveaway-icon.svg" alt="">
      <span>–†–û–ó–´–ì–†–´–®</span>
    </a>
    <a href="#" class="topbar-item">
      <img src="medal.svg" alt="">
      <span>–¢–£–†–ù–ò–†</span>
    </a>
    
    <button class="auth-btn" id="loginBtn">–í–æ–π—Ç–∏ —Å Google</button>

    <div class="user-info" id="userInfo">
      <a href="profile.html"><img id="userPhoto" src="" alt="–ü—Ä–æ—Ñ–∏–ª—å"></a>
      <div class="user-text">
        <span class="hello-text">–ü—Ä–∏–≤–µ—Ç,</span>
        <span id="usernameDisplay" class="nickname"></span>
        <span class="balance-text">
          –Ω–∞ —Å—á–µ—Ç–µ <span id="balanceDisplay" class="balance-amount">0.00 ‚ÇΩ</span> 
        </span>
      </div>
    </div>
  </div>

  <main>
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Case Battle üéÆ</h1>
    <p>–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–≤–æ—ë –∏–º—è, —Ñ–æ—Ç–æ –∏ –±–∞–ª–∞–Ω—Å.</p>

    <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
    <div class="admin-panel" id="adminPanel">
      <h3>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å üí∞</h3>
      <input type="text" id="targetUid" placeholder="UID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
      <input type="number" id="amountInput" placeholder="–°—É–º–º–∞ ‚ÇΩ">
      <button onclick="addBalance()">–í—ã–¥–∞—Ç—å –±–∞–ª–∞–Ω—Å</button>
    </div>
  </main>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDn_hZA2IuN9pKDSLnFcdTXfreRBrtfQ2M",
      authDomain: "case-battle-af897.firebaseapp.com",
      projectId: "case-battle-af897",
      storageBucket: "case-battle-af897.firebasestorage.app",
      messagingSenderId: "485044842847",
      appId: "1:485044842847:web:869c6e455b9d781ab9c6ea",
      measurementId: "G-N3P3CK60GB"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const provider = new firebase.auth.GoogleAuthProvider();

    // UID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π!)
    const adminUIDs = ['IEJvXT2H3OcRF3rof9uxaUfCaB62'];

    // –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google
    document.getElementById("loginBtn").addEventListener("click", async () => {
      try {
        await auth.signInWithPopup(provider);
      } catch (error) {
        alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: " + error.message);
      }
    });

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    auth.onAuthStateChanged(async (user) => {
      const loginBtn = document.getElementById("loginBtn");
      const userInfo = document.getElementById("userInfo");
      const usernameDisplay = document.getElementById("usernameDisplay");
      const userPhoto = document.getElementById("userPhoto");
      const adminPanel = document.getElementById("adminPanel");

      if (user) {
        loginBtn.style.display = "none";
        userInfo.style.display = "flex";

        usernameDisplay.textContent = user.displayName || "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
        userPhoto.src = user.photoURL || "default-avatar.png";

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å, –µ—Å–ª–∏ –∞–¥–º–∏–Ω
        if (adminUIDs.includes(user.uid)) {
          adminPanel.style.display = "block";
        }

        const userRef = db.collection("users").doc(user.uid);
        const docSnap = await userRef.get();

        if (!docSnap.exists) {
          await userRef.set({
            name: user.displayName || "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
            balance: 0
          });
          document.getElementById("balanceDisplay").textContent = "0.00 ‚ÇΩ";
        } else {
          const data = docSnap.data();
          document.getElementById("balanceDisplay").textContent = `${(data.balance || 0).toFixed(2)} ‚ÇΩ`;
        }
      } else {
        loginBtn.style.display = "block";
        userInfo.style.display = "none";
        adminPanel.style.display = "none";
      }
    });

    // –§—É–Ω–∫—Ü–∏—è –≤—ã–¥–∞—á–∏ –±–∞–ª–∞–Ω—Å–∞
    // üîπ –í—ã–¥–∞—á–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–æ UID
async function addBalance() {
  const admin = firebase.auth().currentUser;
  if (!admin) return alert("–í—ã –Ω–µ –≤–æ—à–ª–∏!");
  if (!adminUIDs.includes(admin.uid)) return alert("–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!");

  const targetUid = document.getElementById("targetUid").value.trim(); // UID –∫–æ–≥–æ –ø–æ–ø–æ–ª–Ω–∏—Ç—å
  const amount = parseFloat(document.getElementById("amountInput").value); // —Å—É–º–º–∞

  if (!targetUid) return alert("–í–≤–µ–¥–∏—Ç–µ UID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!");
  if (isNaN(amount) || amount <= 0) return alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É!");

  // –ü–æ–ª—É—á–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const userRef = db.collection("users").doc(targetUid);
  const docSnap = await userRef.get();

  if (!docSnap.exists) {
    alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º UID –Ω–µ –Ω–∞–π–¥–µ–Ω!");
    return;
  }

  const currentBalance = docSnap.data().balance || 0;
  const newBalance = currentBalance + amount;

  await userRef.update({ balance: newBalance });

  alert(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (${targetUid}) –≤—ã–¥–∞–Ω–æ ${amount.toFixed(2)} ‚ÇΩ`);
}

  </script>
</body>
</html>
