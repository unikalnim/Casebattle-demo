<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Case Battle — Главная</title>
  <style>
    :root { --sidebar-width: 182px; }
    body {
      margin: 0;
      color: #fff;
      background: #1b1f27;
      font-family: Arial, sans-serif;
    }
    header {
      position: fixed;
      width: var(--sidebar-width);
      height: 100vh;
      background: #13171f;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
      z-index: 1000;
    }
    header img.logo { height: 62px; margin-top: 1px; }
    .topbar {
      position: relative;
      background: #13171f;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding: 0 25px;
      gap: 50px;
      margin-left: var(--sidebar-width);
    }
    .topbar-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: #ffffff;
      transition: transform 0.2s ease, filter 0.2s ease;
    }
    .topbar-item img { width: 30px; height: 30px; }
    .topbar-item span { font-size: 11px; margin-top: 5px; }
    .topbar-item:hover {
     transform:none ;
     filter: no;
    }
    .user-info {
      display: none;
      align-items: center;
      gap: 12px;
      background: none;
      color: white;
    }
    .user-info img {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      border: 2px solid #f07a3f;
      object-fit: cover;
    }
    .user-text {
      display: flex;
      flex-direction: column;
      gap: 1px;
      line-height: 1.1;
      font-size: 12px;
      font-weight: 400;
    }
    .hello-text {
      color: #f07a3f;
      font-weight: 500;
      font-size: 12px;
    }
    .nickname {
      color: #ffffff;
      font-size: 13px;
      font-weight: 500;
    }
    .balance-text { color: #ffffff; font-size: 11px; font-weight: 400; }
    .balance-amount {
      color: #f07a3f;
      font-weight: 500;
      font-size: 12px;
    }
    .auth-btn, .user-info {
      margin-left: auto;
      border-radius: 8px;
      padding: 10px 18px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
    }
    .auth-btn {
      background-color: #f07a3f;
      color: #fff;
      border: none;
      transition: background 0.3s;
    }
    .auth-btn:hover { background-color: #ff8b55; }
    main {
      margin-left: calc(var(--sidebar-width));
      padding: 30px;
    }
  </style>
</head>
<body>

  <header>
    <a href="index.html"><img src="Screenshot (5).png" alt="logo" class="logo"></a>
  </header>

  <div class="topbar">
    <a href="#" class="topbar-item">
      <img src="upgrade-icon.svg" alt="">
      <span>АПГРЕЙД</span>
    </a>
    <a href="#" class="topbar-item">
      <img src="contract-icon.svg" alt="">
      <span>КОНТРАКТ</span>
    </a>
    <a href="#" class="topbar-item">
      <img src="giveaway-icon.svg" alt="">
      <span>РОЗЫГРЫШ</span>
    </a>
    <a href="#" class="topbar-item">
      <img src="medal.svg" alt="">
      <span>ТУРНИР</span>
    </a>
    <a href="admin.html" class="topbar-item">
      <img src="ico-profile-success.png" alt="">
      <span>ADMIN</span>
    </a>
    
    <button class="auth-btn" id="loginBtn">Войти с Google</button>

    <div class="user-info" id="userInfo">
      <a href="profile.html"><img id="userPhoto" src="" alt="Профиль"></a>
      <div class="user-text">
        <span class="hello-text">Привет,</span>
        <span id="usernameDisplay" class="nickname"></span>
        <span class="balance-text">
          на счете <span id="balanceDisplay" class="balance-amount">0.00 ₽</span> 
        </span>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDn_hZA2IuN9pKDSLnFcdTXfreRBrtfQ2M",
      authDomain: "case-battle-af897.firebaseapp.com",
      projectId: "case-battle-af897",
      storageBucket: "case-battle-af897.firebasestorage.app",
      messagingSenderId: "485044842847",
      appId: "1:485044842847:web:869c6e455b9d781ab9c6ea",
      measurementId: "G-N3P3CK60GB"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const provider = new firebase.auth.GoogleAuthProvider();

    // UID администраторов
    const adminUIDs = ['IEJvXT2H3OcRF3rof9uxaUfCaB62'];

    document.getElementById("loginBtn").addEventListener("click", async () => {
      try {
        await auth.signInWithPopup(provider);
      } catch (error) {
        alert("Ошибка входа: " + error.message);
      }
    });

    auth.onAuthStateChanged(async (user) => {
      const loginBtn = document.getElementById("loginBtn");
      const userInfo = document.getElementById("userInfo");
      const usernameDisplay = document.getElementById("usernameDisplay");
      const userPhoto = document.getElementById("userPhoto");

      if (user) {
        loginBtn.style.display = "none";
        userInfo.style.display = "flex";

        usernameDisplay.textContent = user.displayName || "Пользователь";
        userPhoto.src = user.photoURL || "default-avatar.png";

        const userRef = db.collection("users").doc(user.uid);
        const docSnap = await userRef.get();

        if (!docSnap.exists) {
          await userRef.set({
            name: user.displayName || "Пользователь",
            balance: 0
          });
          document.getElementById("balanceDisplay").textContent = "0.00 ₽";
        } else {
          const data = docSnap.data();
          document.getElementById("balanceDisplay").textContent = `${(data.balance || 0).toFixed(2)} ₽`;
        }
      } else {
        loginBtn.style.display = "block";
        userInfo.style.display = "none";
      }
    });

    // Выдача баланса
    async function addBalance() {
      const admin = firebase.auth().currentUser;
      if (!admin) return alert("Вы не вошли!");
      if (!adminUIDs.includes(admin.uid)) return alert("У вас нет прав администратора!");

      const targetUid = document.getElementById("targetUid").value.trim();
      const amount = parseFloat(document.getElementById("amountInput").value);

      if (!targetUid) return alert("Введите UID пользователя!");
      if (isNaN(amount) || amount <= 0) return alert("Введите корректную сумму!");

      const userRef = db.collection("users").doc(targetUid);
      const docSnap = await userRef.get();

      if (!docSnap.exists) {
        alert("Пользователь с таким UID не найден!");
        return;
      }

      const currentBalance = docSnap.data().balance || 0;
      const newBalance = currentBalance + amount;

      await userRef.update({ balance: newBalance });

      alert(`✅ Пользователю (${targetUid}) выдано ${amount.toFixed(2)} ₽`);
    }
  </script>
</body>
</html>
